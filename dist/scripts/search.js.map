{"version":3,"sources":["../../scripts/search.js"],"names":["Search","el","$el","$input","querySelector","$songs","$singer","addEventListener","onKeyUp","bind","keyword","page","songs","perpage","event","target","value","trim","console","log","innerHTML","key","searchSinger","search","fetch","then","res","json","data","song","list","append","zhida","appendSinger","singerHtml","singername","songnum","albumnum","singer","html","map","songname","name","join"],"mappings":";;;;;;IAAMA,M;AACF,oBAAYC,EAAZ,EAAgB;AAAA;;AACZ,aAAKC,GAAL,GAAWD,EAAX;AACA,aAAKE,MAAL,GAAc,KAAKD,GAAL,CAASE,aAAT,CAAuB,SAAvB,CAAd;AACA,aAAKC,MAAL,GAAc,KAAKH,GAAL,CAASE,aAAT,CAAuB,oBAAvB,CAAd;AACA,aAAKE,OAAL,GAAe,KAAKJ,GAAL,CAASE,aAAT,CAAuB,yBAAvB,CAAf;AACA,aAAKD,MAAL,CAAYI,gBAAZ,CAA6B,OAA7B,EAAqC,KAAKC,OAAL,CAAaC,IAAb,CAAkB,IAAlB,CAArC;AACA,aAAKC,OAAL,GAAe,EAAf;AACA,aAAKC,IAAL,GAAY,CAAZ;AACA,aAAKC,KAAL,GAAa,EAAb;AACA,aAAKC,OAAL,GAAe,EAAf;AACH;;;;gCAEOC,K,EAAM;AACV,gBAAIJ,UAAUI,MAAMC,MAAN,CAAaC,KAAb,CAAmBC,IAAnB,EAAd;AACAC,oBAAQC,GAAR,CAAYT,OAAZ;AACA,gBAAGA,WAAW,EAAd,EAAkB;AACd,qBAAKL,MAAL,CAAYe,SAAZ,GAAwB,EAAxB;AACA,qBAAKd,OAAL,CAAac,SAAb,GAAyB,EAAzB;AACH;AACD,gBAAGN,MAAMO,GAAN,KAAc,OAAjB,EAA0B;AAC1B,iBAAKC,YAAL,CAAkBZ,OAAlB;AACA,iBAAKa,MAAL,CAAYb,OAAZ;AACH;;;+BAEMA,O,EAAQ;AAAA;;AACX,iBAAKA,OAAL,GAAeA,OAAf;AACAc,4DAA8C,KAAKd,OAAnD,cAAmE,KAAKC,IAAxE,EACKc,IADL,CACU;AAAA,uBAAOC,IAAIC,IAAJ,EAAP;AAAA,aADV,EAEKF,IAFL,CAEU;AAAA,uBAAQE,KAAKC,IAAL,CAAUC,IAAV,CAAeC,IAAvB;AAAA,aAFV,EAGKL,IAHL,CAGU;AAAA,uBAAS,MAAKM,MAAL,CAAYnB,KAAZ,CAAT;AAAA,aAHV;AAIH;;;qCAEYF,O,EAAQ;AAAA;;AACjBc,4DAA8Cd,OAA9C,cAA8D,KAAKC,IAAnE,EACKc,IADL,CACU;AAAA,uBAAOC,IAAIC,IAAJ,EAAP;AAAA,aADV,EAEKF,IAFL,CAEU;AAAA,uBAAQE,KAAKC,IAAL,CAAUI,KAAlB;AAAA,aAFV,EAGKP,IAHL,CAGU;AAAA,uBAAS,OAAKQ,YAAL,CAAkBD,KAAlB,CAAT;AAAA,aAHV;AAIH;;;qCAEYA,K,EAAM;AACf,gBAAIE,gRAKkBF,MAAMG,UALxB,8DAM2BH,MAAMI,OANjC,iCAM0DJ,MAAMK,QANhE,yCAAJ;;AASA,iBAAK/B,OAAL,CAAac,SAAb,GAAyBc,UAAzB;AACH;;;+BAEMtB,K,EAAO0B,M,EAAO;AACjB,gBAAIC,OAAO3B,MAAM4B,GAAN,CAAU;AAAA,yMAKHX,KAAKY,QALF,sCAMJZ,KAAKS,MAAL,CAAYE,GAAZ,CAAgB;AAAA,2BAAUF,OAAOI,IAAjB;AAAA,iBAAhB,EAAuCC,IAAvC,CAA4C,GAA5C,CANI;AAAA,aAAV,EASTA,IATS,CASJ,EATI,CAAX;AAUA,iBAAKtC,MAAL,CAAYe,SAAZ,GAAwBmB,IAAxB;AACH","file":"search.js","sourcesContent":["class Search{\r\n    constructor(el) {\r\n        this.$el = el\r\n        this.$input = this.$el.querySelector(\".search\")\r\n        this.$songs = this.$el.querySelector(\".search-content ul\")\r\n        this.$singer = this.$el.querySelector(\".search-content .singer\")\r\n        this.$input.addEventListener(\"keyup\",this.onKeyUp.bind(this))\r\n        this.keyword = ''\r\n        this.page = 1\r\n        this.songs = []\r\n        this.perpage = 20\r\n    }\r\n\r\n    onKeyUp(event){\r\n        let keyword = event.target.value.trim()\r\n        console.log(keyword)\r\n        if(keyword == '') {\r\n            this.$songs.innerHTML = \"\"\r\n            this.$singer.innerHTML = ''\r\n        }\r\n        if(event.key !== \"Enter\") return\r\n        this.searchSinger(keyword)\r\n        this.search(keyword)\r\n    }\r\n\r\n    search(keyword){\r\n        this.keyword = keyword\r\n        fetch(`http://localhost:4000/search?keyword=${this.keyword}&page=${this.page}`)\r\n            .then(res => res.json())\r\n            .then(json => json.data.song.list)\r\n            .then(songs => this.append(songs))\r\n    }\r\n\r\n    searchSinger(keyword){\r\n        fetch(`http://localhost:4000/search?keyword=${keyword}&page=${this.page}`)\r\n            .then(res => res.json())\r\n            .then(json => json.data.zhida)\r\n            .then(zhida => this.appendSinger(zhida))\r\n    }\r\n\r\n    appendSinger(zhida){\r\n        let singerHtml = `\r\n        <div class=\"img\">\r\n                        <img src=\"https://y.gtimg.cn/music/photo_new/T001R68x68M000000aHmbL2aPXWH.jpg?max_age=2592000\" />\r\n                    </div>\r\n                    <div class=\"text\">\r\n                        <h4>${zhida.singername}</h4>\r\n                        <p>单曲: <span>${zhida.songnum}</span> 专辑: <i>${zhida.albumnum}</i></p>\r\n                    </div>`\r\n\r\n        this.$singer.innerHTML = singerHtml\r\n    }\r\n\r\n    append(songs, singer){\r\n        let html = songs.map(song =>`<li>\r\n                <div class=\"img\">\r\n                    <i class=\"icon\"></i>\r\n                </div>\r\n                <div class=\"text\">\r\n                    <h4>${song.songname}</h4>\r\n                    <p>${song.singer.map(singer => singer.name).join(\"/\")}</p>\r\n                </div>\r\n            </li>`\r\n        ).join(\"\")\r\n        this.$songs.innerHTML = html\r\n    }\r\n}"]}