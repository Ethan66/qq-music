{"version":3,"sources":["../../scripts/LyricsPlayer.js"],"names":["text","LyricsPlayer","el","$el","elapsed","index","lyrics","reset","start","intervalId","setInterval","update","bind","clearInterval","length","i","seconds","getSeconds","$lines","classList","remove","add","y","$lyrics_text","style","transform","formatText","console","log","match","render","querySelectorAll","querySelector","div","document","createElement","html","map","slice","join","innerHTML","appendChild","innerText","line","replace","p1","p2"],"mappings":"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","file":"LyricsPlayer.js","sourcesContent":["var text = \"[ti&#58;江南1&#95;A&#32;1&#45;2]&#10;[ar&#58;&#32;]&#10;[al&#58;]&#10;[by&#58;]&#10;[offset&#58;0]&#10;[00&#58;00&#46;26]江南&#32;&#40;Live&#41;&#32;&#45;&#32;林忆莲/林俊杰&#10;[00&#58;00&#46;99]词：李瑞洵&#10;[00&#58;01&#46;89]曲：林俊杰&#10;[00&#58;02&#46;04]原唱：林俊杰&#10;[00&#58;02&#46;24]编曲：Kenn&#32;C/James&#32;Yeo&#64;Kenn&#32;C&#32;Music&#10;[00&#58;02&#46;50]制作人：陈君豪/恭硕良&#10;[00&#58;03&#46;63]音乐总监：刘卓&#10;[00&#58;03&#46;85]音响总监：金少刚&#10;[00&#58;04&#46;11]吉他：Derrick&#32;Sepnio&#10;[00&#58;04&#46;28]键盘：林俊杰/刘卓/Fergus&#32;Chow&#10;[00&#58;04&#46;63]Program：尹岳洋&#10;[00&#58;04&#46;79]贝斯：Ray&#32;Vaughn&#10;[00&#58;04&#46;95]鼓手：恭硕良&#10;[00&#58;05&#46;15]和音：朱江/刘芳/张炜/关冰效&#10;[00&#58;05&#46;64]弦乐：靳海音®弦乐团&#10;[00&#58;05&#46;96]和音编写：恭硕良/林忆莲/潘琪妮&#10;[00&#58;07&#46;50]&#10;[00&#58;11&#46;33]执行制作：钟潍宇&#10;[00&#58;13&#46;10]&#10;[00&#58;31&#46;87]女：&#10;[00&#58;31&#46;87]风到这里就是粘&#10;[00&#58;34&#46;56]&#10;[00&#58;35&#46;89]粘住过客的思念&#10;[00&#58;39&#46;20]&#10;[00&#58;41&#46;02]雨到了这里缠成线&#10;[00&#58;44&#46;22]&#10;[00&#58;45&#46;48]缠着我们流连人世间&#10;[00&#58;49&#46;77]&#10;[00&#58;50&#46;89]你在身边就是缘&#10;[00&#58;53&#46;64]&#10;[00&#58;55&#46;12]缘分写在三生石上面&#10;[00&#58;59&#46;12]&#10;[01&#58;00&#46;49]爱有万分之一甜&#10;[01&#58;03&#46;53]&#10;[01&#58;04&#46;75]宁愿我就葬在这一天&#10;[01&#58;10&#46;45]&#10;[01&#58;12&#46;45]圈圈圆圆圈圈&#10;[01&#58;14&#46;50]天天年年天天的我&#10;[01&#58;17&#46;79]深深看你的脸&#10;[01&#58;20&#46;90]生气的温柔埋怨的温柔你的脸&#10;[01&#58;28&#46;62]&#10;[01&#58;31&#46;80]不懂爱恨情愁煎熬的我们&#10;[01&#58;35&#46;69]&#10;[01&#58;36&#46;31]都以为相爱就像风云的善变&#10;[01&#58;40&#46;45]&#10;[01&#58;41&#46;23]相信爱一天抵过永远&#10;[01&#58;45&#46;85]&#10;[01&#58;46&#46;45]在这一刹那冻结了时间&#10;[01&#58;50&#46;49]&#10;[01&#58;51&#46;14]不懂怎么表现温柔的我们&#10;[01&#58;54&#46;82]&#10;[01&#58;55&#46;59]还以为殉情只是古老的传言&#10;[01&#58;59&#46;66]&#10;[02&#58;00&#46;32]离愁能有多痛痛有多浓&#10;[02&#58;04&#46;97]&#10;[02&#58;05&#46;53]当梦被埋在江南烟雨中心碎了才懂&#10;[02&#58;13&#46;63]&#10;[02&#58;30&#46;48]圈圈圆圆圈圈&#10;[02&#58;32&#46;44]天天年年天天的我&#10;[02&#58;35&#46;79]深深看你的脸&#10;[02&#58;38&#46;92]&#10;[02&#58;40&#46;65]生气的温柔埋怨的温柔的脸&#10;[02&#58;51&#46;98]男：&#10;[02&#58;52&#46;33]不懂爱恨情愁煎熬的我们&#10;[02&#58;56&#46;15]&#10;[02&#58;56&#46;67]都以为相爱就像风云的善变&#10;[03&#58;00&#46;93]&#10;[03&#58;01&#46;45]相信爱一天抵过永远&#10;[03&#58;06&#46;64]在这一刹那冻结了时间&#10;[03&#58;10&#46;82]&#10;[03&#58;11&#46;49]不懂怎么表现温柔的我们&#10;[03&#58;16&#46;17]还以为殉情只是古老的传言&#10;[03&#58;21&#46;03]离愁能有多痛痛有多浓&#10;[03&#58;26&#46;21]当梦被埋在江南烟雨中&#10;[03&#58;30&#46;35]心碎了才懂&#10;[03&#58;37&#46;07]&#10;[03&#58;54&#46;05]女：&#10;[03&#58;54&#46;41]&#10;[04&#58;01&#46;88]不懂爱恨情愁煎熬的我们&#10;[04&#58;05&#46;93]&#10;[04&#58;06&#46;71]都以为相爱就像风云的善变&#10;[04&#58;10&#46;93]&#10;[04&#58;11&#46;79]相信爱一天抵过永远&#10;[04&#58;16&#46;40]&#10;[04&#58;16&#46;98]在这一刹那冻结了时间&#10;[04&#58;20&#46;65]&#10;[04&#58;21&#46;55]不懂怎么表现温柔的我们&#10;[04&#58;25&#46;97]还以为殉情只是古老的传言&#10;[04&#58;30&#46;78]离愁能有多痛痛有多浓&#10;[04&#58;36&#46;19]当梦被埋在江南烟雨中&#10;[04&#58;40&#46;91]&#10;[04&#58;52&#46;71]心碎了才懂&#10;[04&#58;59&#46;70]合：&#10;[05&#58;00&#46;08]&#10;[05&#58;12&#46;04]心碎了才懂\"\r\n\r\nclass LyricsPlayer{\r\n    constructor(el){\r\n        this.$el = el\r\n        this.elapsed = 0\r\n        this.text = ''\r\n        this.index = 0\r\n        this.lyrics = []\r\n        this.reset(text)\r\n        this.start()\r\n    }\r\n\r\n    start(){\r\n        this.intervalId = setInterval(this.update.bind(this), 1000)\r\n    }\r\n\r\n    pause(){\r\n        clearInterval(this.intervalId)\r\n    }\r\n\r\n    update(){\r\n        this.elapsed += 1\r\n        if(this.index === this.lyrics.length - 1) return this.reset(text)\r\n        for(let i = this.index + 1; i<this.lyrics.length - 1; i++){\r\n            let seconds = this.getSeconds(this.lyrics[i])\r\n            if(\r\n                this.elapsed === seconds &&\r\n                (!this.lyrics[i + 1] || this.elapsed < this.getSeconds(this.lyrics[i + 1]))\r\n            ){\r\n                this.$lines[this.index].classList.remove(\"active\")\r\n                this.$lines[i].classList.add(\"active\")\r\n                this.index = i\r\n                break\r\n            }\r\n            if(this.index > 2){\r\n                let y = -(this.index - 2) * 42\r\n                this.$lyrics_text.style.transform = `translateY(${y}px)`\r\n            }\r\n        }\r\n    }\r\n\r\n    reset(text){\r\n        if(text){\r\n            this.text = this.formatText(text)\r\n            console.log(this.text)\r\n            this.lyrics = this.text.match(/^\\[\\d{2}:\\d{2}\\.\\d{2}\\].+$/gm)\r\n            if(this.lyrics.length){\r\n                this.render()\r\n                this.$lines = this.$el.querySelectorAll(\"p\")\r\n                this.$lyrics_text = this.$el.querySelector(\".lyrics-text\")\r\n            }\r\n        }\r\n    }\r\n\r\n    render(){\r\n        let div = document.createElement(\"div\")\r\n        div.classList.add(\"lyrics-text\")\r\n        let html = this.lyrics.map(lyrics => {\r\n            return `<p>${lyrics.slice(10)}</p>`\r\n        }).join(\"\")\r\n        div.innerHTML = html\r\n        this.$el.appendChild(div)\r\n        /*let html =`\r\n        <div class=\"lyrics-text\">\r\n            <p>江南 (Live) - 林忆莲/林俊杰</p>\r\n            <p>词：李瑞洵</p>\r\n            <p>原唱：林俊杰</p>\r\n            <p>制作人：陈君豪/恭硕良</p>\r\n            <p>江南 (Live) - 林忆莲/林俊杰</p>\r\n            <p>词：李瑞洵</p>\r\n            <p>原唱：林俊杰</p>\r\n            <p>制作人：陈君豪/恭硕良</p>\r\n            <p>江南 (Live) - 林忆莲/林俊杰</p>\r\n            <p>词：李瑞洵</p>\r\n            <p>原唱：林俊杰</p>\r\n            <p>制作人：陈君豪/恭硕良</p>\r\n        </div>`*/\r\n    }\r\n\r\n    formatText(text){\r\n        let div = document.createElement(\"div\")\r\n        div.innerHTML = text\r\n        return div.innerText\r\n    }\r\n\r\n    getSeconds(line){\r\n        return +line.replace(/^\\[(\\d{2}):(\\d{2}).*/,(match, p1, p2) => 60 * (+p1) + (+p2))\r\n    }\r\n}"]}